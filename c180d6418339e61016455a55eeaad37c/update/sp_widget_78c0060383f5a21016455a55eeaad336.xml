<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function UploadExcelToMRVSController($scope, $http) {
$scope.uploadExcel = function(fileInput) {
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    const arrayBuffer = event.target.result;
		
    $http({
      method: 'POST',
      url: '/api/now/attachment/file',
      params: {
        table_name: 'sc_cart_item',
        table_sys_id: $scope.data.sys_id,
        file_name: file.name
      },
      data: arrayBuffer,
      headers: {
        'Content-Type': file.type || 'application/octet-stream',
        'Accept': 'application/json'
      },
      transformRequest: angular.identity,
      responseType: 'json'
    }).then(function(response) {
      const attachmentSysId = response.data.result.sys_id;

      const ga = new GlideAjax('x_1758036_scriptin.ExcelFromAttachmentProcessor');
			ga.addParam('sysparm_name', 'processAttachment');
      ga.addParam('sysparm_attachment_id', attachmentSysId);
      ga.getXMLAnswer(function(responseJSON) {
      $scope.page.g_form.setValue('demo_completion_progress',responseJSON);
      });
    }, function(error) {
      console.error("Upload failed:", error);
    });
  };

  reader.readAsArrayBuffer(file); 
};

}
]]></client_script>
        <controller_as>c</controller_as>
        <css>.upload-button {
  display: inline-block;
  background-color: #f0f0f0;
  color: #333;
  font-weight: 600;
  padding: 10px 16px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  border: 1px solid #ccc;
}
.upload-button:hover {
  background-color: #e0e0e0;
}
.upload-input-hidden {
  display: none;
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>uploadexceltomrvs</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>UploadExcelToMRVS</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  data.sys_id = $sp.getParameter('sys_id') || '';
})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-06-02 13:44:12</sys_created_on>
        <sys_id>78c0060383f5a21016455a55eeaad336</sys_id>
        <sys_mod_count>43</sys_mod_count>
        <sys_name>UploadExcelToMRVS</sys_name>
        <sys_package display_value="ScriptingDemo3" source="x_1758036_scriptin">c180d6418339e61016455a55eeaad37c</sys_package>
        <sys_policy/>
        <sys_scope display_value="ScriptingDemo3">c180d6418339e61016455a55eeaad37c</sys_scope>
        <sys_update_name>sp_widget_78c0060383f5a21016455a55eeaad336</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-06-04 10:36:10</sys_updated_on>
        <template><![CDATA[<label class="upload-button">
  Upload Excel
  <input type="file" accept=".xlsx" class="upload-input-hidden" onchange="angular.element(this).scope().uploadExcel(this)" />
</label>
]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>78c0060383f5a21016455a55eeaad336</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-06-02 13:44:12</sys_created_on>
        <sys_id>38c0060383f5a21016455a55eeaad33a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-06-02 13:44:12</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
